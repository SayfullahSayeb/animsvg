<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to SVG Converter</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Poppins,sans-serif;background:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;color:#333}.container{max-width:800px;width:100%}h1{margin-bottom:30px;text-align:center;font-size:28px;font-weight:600}.upload-area{border:2px solid #ddd;border-radius:8px;padding:40px;text-align:center;cursor:pointer;transition:all 0.2s ease;margin-bottom:30px}.upload-area:hover{border-color:#999;background:#fafafa}.upload-area.dragover{border-color:#333;background:#f5f5f5}.upload-area p{font-size:14px}.upload-area p strong{display:block;margin-bottom:8px;font-weight:600}.upload-area p:last-child{color:#666;font-size:13px}#fileInput{display:none}.preview-container{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px}.preview-box{border:1px solid #eee;border-radius:6px;padding:15px}.preview-box h3{font-size:12px;font-weight:600;color:#666;margin-bottom:12px;text-transform:uppercase;letter-spacing:.5px}.preview-box img,.preview-box svg{max-width:100%;max-height:300px;margin:0 auto;display:block}.button-group{display:flex;gap:12px}button{flex:1;padding:12px 24px;border:1px solid #ddd;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;transition:all 0.2s ease;background:#fff;color:#333}button:hover:not(:disabled){border-color:#333;background:#f9f9f9}button:active:not(:disabled){background:#f0f0f0}button:disabled{opacity:.5;cursor:not-allowed}.loading{text-align:center;font-size:14px;color:#666;margin:20px 0;display:none}.error{padding:12px;border-radius:6px;margin-bottom:20px;display:none;font-size:14px;border:1px solid #ffcccb;background:#fff5f5;color:#c53030}.success{padding:12px;border-radius:6px;margin-bottom:20px;display:none;font-size:14px;border:1px solid #c6f6d5;background:#f0fdf4;color:#22543d}@media (max-width:600px){h1{font-size:24px}.preview-container{grid-template-columns:1fr}.button-group{flex-direction:column}.upload-area{padding:30px 20px}}
    </style>
</head>
<body>
    <div class="container">
        <h1>Image to SVG Converter</h1>

        <div class="error" id="error"></div>
        <div class="success" id="success"></div>

        <div class="upload-area" id="uploadArea">
            <p><strong>Drag and drop your image here</strong></p>
            <p>or click to browse (PNG, JPG, GIF)</p>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="preview-container" id="previewContainer" style="display: none;">
            <div class="preview-box">
                <h3>Original Image</h3>
                <img id="previewImage" alt="Original">
            </div>
            <div class="preview-box">
                <h3>SVG Result</h3>
                <svg id="previewSVG"></svg>
            </div>
        </div>

        <div class="loading" id="loading">
            Processing image... This may take a few seconds.
        </div>

        <div class="button-group">
            <button onclick="document.getElementById('fileInput').click()">Choose Image</button>
            <button id="downloadBtn" disabled>Download SVG</button>
        </div>
    </div>

    <script type="module">
        import { potrace, init } from 'https://cdn.jsdelivr.net/npm/esm-potrace-wasm@0.4.1/+esm';

        let currentSVG = null;
        let uploadArea = document.getElementById('uploadArea');
        let fileInput = document.getElementById('fileInput');
        let previewImage = document.getElementById('previewImage');
        let previewSVG = document.getElementById('previewSVG');
        let previewContainer = document.getElementById('previewContainer');
        let downloadBtn = document.getElementById('downloadBtn');
        let loading = document.getElementById('loading');
        let errorDiv = document.getElementById('error');
        let successDiv = document.getElementById('success');

        await init();

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        async function handleFile(file) {
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            if (!file.type.startsWith('image/')) {
                showError('Please upload an image file');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewContainer.style.display = 'grid';
                processImage();
            };
            reader.readAsDataURL(file);
        }

        async function processImage() {
            loading.style.display = 'block';
            errorDiv.style.display = 'none';

            try {
                const img = new Image();
                img.onload = async () => {
                    const options = {
                        turdsize: 2,
                        turnpolicy: 4,
                        alphamax: 1,
                        opticurve: 1,
                        opttolerance: 0.2,
                        pathonly: false,
                        extractcolors: false,
                        posterizelevel: 2,
                        posterizationalgorithm: 0
                    };

                    const svg = await potrace(img, options);
                    currentSVG = svg;
                    displaySVG(svg);
                    downloadBtn.disabled = false;
                    loading.style.display = 'none';
                    showSuccess('Image converted successfully');
                };
                img.onerror = () => {
                    showError('Failed to load image');
                    loading.style.display = 'none';
                };
                img.src = previewImage.src;
            } catch (err) {
                console.error(err);
                showError('Error processing image: ' + err.message);
                loading.style.display = 'none';
            }
        }

        function displaySVG(svgStr) {
            previewSVG.innerHTML = '';
            const width = previewImage.naturalWidth;
            const height = previewImage.naturalHeight;
            const parser = new DOMParser();
            const svgDoc = parser.parseFromString(svgStr, 'image/svg+xml');
            const svgElem = svgDoc.documentElement;
            svgElem.removeAttribute("width");
            svgElem.removeAttribute("height");
            svgElem.setAttribute("viewBox", `0 0 ${width} ${height}`);
            svgElem.style.width = "100%";
            svgElem.style.height = "auto";
            svgElem.style.display = "block";
            previewSVG.appendChild(svgElem);
        }

        downloadBtn.addEventListener('click', () => {
            if (!currentSVG) return;

            const blob = new Blob([currentSVG], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'image-' + Date.now() + '.svg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        function showError(message) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function showSuccess(message) {
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
